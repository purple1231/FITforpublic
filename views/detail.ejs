<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= item.name %> - ShopMall</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/detail.css">
    <style>
        .cart-popup {
        position: fixed;
        bottom: -100px; /* ê¸°ë³¸ì ìœ¼ë¡œ ì•ˆ ë³´ì´ê²Œ */
        left: 50%;
        transform: translateX(-50%);
        background-color: #ff7f00;
        color: white;
        padding: 16px 24px;
        border-radius: 10px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 1rem;
        z-index: 9999;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        transition: bottom 0.3s ease-in-out;
        }

        .cart-popup.show {
        bottom: 40px; /* íŒì—…ì´ ì˜¬ë¼ì˜´ */
        }

        .cart-popup button {
        background-color: white;
        color: #ff7f00;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        }
    </style>
</head>
<body>




    
    <input type="hidden" id="clothId" value="<%= item.id %>">
    <input type="hidden" id="clothType" value="<%= item.type %>">
    <input type="hidden" id="clothImageUrl" value="<%= item.image_url %>">
    <!-- Header -->
    <header>
        <nav class="container">
            <a href="/home" class="logo">
                <img src="https://res.cloudinary.com/dplzmk1ex/image/upload/v1750611338/ChatGPT_Image_2025%EB%85%84_6%EC%9B%94_15%EC%9D%BC_%EC%98%A4%EC%A0%84_01_43_06_yofrkr.png" alt="Fashion Store Logo" style="height:40px;">
            </a></a>
            <ul class="nav-links">
                <li><a href="/home">í™ˆ</a></li>
                <li><a href="#">ì¹´í…Œê³ ë¦¬</a></li>
                <li><a href="#">ë² ìŠ¤íŠ¸</a></li>
                <li><a href="#">ì„¸ì¼</a></li>
                <li><a href="#">ë¸Œëœë“œ</a></li>
            </ul>
            <div class="nav-icons">
                <a href="#"><i class="fas fa-search"></i></a>
                <a href="#"><i class="fas fa-heart"></i></a>
                <a href="/cart" id="cartIcon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count"><%= cartCount || 0 %></span>
                </a>
                <a href="#"><i class="fas fa-user"></i></a>
            </div>
        </nav>
    </header>

    <!-- Breadcrumb -->
    <section class="breadcrumb">
        <div class="container">
            <nav class="breadcrumb-nav">
                <a href="#">í™ˆ</a>
                <i class="fas fa-chevron-right"></i>
                <a href="#">ì˜ë¥˜</a>
                <i class="fas fa-chevron-right"></i>
                <a href="#"><%= item.type %></a>
                <i class="fas fa-chevron-right"></i>
                <span><%= item.name %></span>
            </nav>
        </div>
    </section>

    <!-- Product Detail -->
    <section class="product-detail">
        <div class="container">
            <div class="product-container">
                <!-- Product Images -->
                <div class="product-images">
                    <img src="<%= item.image_url %>" alt="<%= item.name %>" class="main-image" id="mainImage">
                    <div class="thumbnail-images">
                        <img src="<%= item.image_url %>" alt="ì¸ë„¤ì¼" class="thumbnail active" onclick="changeMainImage(this)">
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                <h1 class="product-title"><%= item.name %></h1>

                <div class="product-rating">
                    <div class="stars">
                        <% 
                        const fullStars = Math.floor(avgRating);
                        const hasHalfStar = avgRating - fullStars >= 0.5;
                        for (let i = 1; i <= 5; i++) {
                            if (i <= fullStars) { %>
                            <i class="fas fa-star"></i>
                        <%  } else if (i === fullStars + 1 && hasHalfStar) { %>
                            <i class="fas fa-star-half-alt"></i>
                        <%  } else { %>
                            <i class="far fa-star"></i>
                        <%  } 
                        }
                        %>
                    </div>
                    <span class="rating-text">
                        <%= avgRating %>ì  (ë¦¬ë·° <%= reviews.length %>ê°œ)
                    </span>
                </div>


                    <div class="product-price">
                        <span class="current-price"><%= item.price.toLocaleString() %>ì›</span>
                        <% if (item.original_price) { %>
                            <span class="original-price"><%= item.original_price.toLocaleString() %>ì›</span>
                            <% const discount = Math.round((1 - item.price / item.original_price) * 100); %>
                            <span class="discount-badge"><%= discount %>% í• ì¸</span>
                        <% } %>
                    </div>

                    <div class="product-options">
                        <!-- Color Selection -->
                        <div class="option-group">
                            <label class="option-label">ìƒ‰ìƒ ì„ íƒ</label>
                            <div class="color-options">
                                <div class="color-option color-black active" data-color="ë¸”ë™" onclick="selectColor(this)"></div>
                                <div class="color-option color-white" data-color="í™”ì´íŠ¸" onclick="selectColor(this)"></div>
                                <div class="color-option color-gray" data-color="ê·¸ë ˆì´" onclick="selectColor(this)"></div>
                                <div class="color-option color-navy" data-color="ë„¤ì´ë¹„" onclick="selectColor(this)"></div>
                            </div>
                            <p>ì„ íƒëœ ìƒ‰ìƒ: <span id="selectedColor">ë¸”ë™</span></p>
                        </div>

                        <!-- Size Selection -->
                        <div class="option-group">
                            <label class="option-label">ì‚¬ì´ì¦ˆ ì„ íƒ</label>
                            <div class="size-options">
                                <div class="size-option" data-size="XS" onclick="selectSize(this)">XS</div>
                                <div class="size-option" data-size="S" onclick="selectSize(this)">S</div>
                                <div class="size-option active" data-size="M" onclick="selectSize(this)">M</div>
                                <div class="size-option" data-size="L" onclick="selectSize(this)">L</div>
                                <div class="size-option" data-size="XL" onclick="selectSize(this)">XL</div>
                                <div class="size-option disabled" data-size="XXL">XXL (í’ˆì ˆ)</div>
                            </div>
                            <a href="#" class="size-guide">ì‚¬ì´ì¦ˆ ê°€ì´ë“œ <i class="fas fa-ruler"></i></a>
                            <p>ì„ íƒëœ ì‚¬ì´ì¦ˆ: <span id="selectedSize">M</span></p>
                        </div>

                        <!-- Quantity -->
                        <div class="option-group">
                            <label class="option-label">ìˆ˜ëŸ‰</label>
                            <div class="quantity-selector">
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                                    <input type="number" class="quantity-input" value="1" min="1" max="10" id="quantity">
                                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Try-On Section -->
                    <div class="ai-try-on">
                        <h3><i class="fas fa-magic"></i> AI ê°€ìƒ í”¼íŒ…</h3>
                        <p>ë‚´ ì‚¬ì§„ì— ì´ ì˜·ì„ ê°€ìƒìœ¼ë¡œ ì…ì–´ë³´ì„¸ìš”!</p>
                        <button class="btn btn-ai" onclick="openAIModal()">
                            <i class="fas fa-camera"></i> AI ì˜·ì…íˆê¸°
                        </button>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="btn btn-wishlist" onclick="toggleWishlist()">
                            <i class="far fa-heart" id="wishlistIcon"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="addToCart()">
                            <i class="fas fa-shopping-cart"></i> ì¥ë°”êµ¬ë‹ˆ
                        </button>
                        <button class="btn btn-primary" onclick="buyNow()">
                            <i class="fas fa-bolt"></i> ë°”ë¡œêµ¬ë§¤
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Tabs -->
            <div class="product-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('description')">ìƒí’ˆì„¤ëª…</button>
                    <button class="tab-btn" onclick="showTab('reviews')">ë¦¬ë·° (<%= reviews.length %>)</button>
                    <button class="tab-btn" onclick="showTab('shipping')">ë°°ì†¡/êµí™˜</button>
                    <button class="tab-btn" onclick="showTab('qna')">Q&A</button>
                </div>

                <div class="tab-content active" id="description">
                    <h3>ìƒí’ˆ ìƒì„¸ ì •ë³´</h3>
                    <p><%= item.description %></p>
                    <br>
                    <h4>ì†Œì¬ ë° ê´€ë¦¬ë²•</h4>
                    <ul>
                        <li>ì†Œì¬: <%= item.material || 'ìš¸ 70%, ìºì‹œë¯¸ì–´ 20%, ë‚˜ì¼ë¡  10%' %></li>
                        <li>ì„¸íƒ: <%= item.washing_method || 'ë“œë¼ì´í´ë¦¬ë‹ ê¶Œì¥' %></li>
                        <li>ë³´ê´€: <%= item.storage_method || 'í†µí’ì´ ì˜ ë˜ëŠ” ê³³ì— ë³´ê´€' %></li>
                    </ul>
                    <br>
                    <h4>ì‚¬ì´ì¦ˆ ì •ë³´</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 10px; border: 1px solid #ddd;">ì‚¬ì´ì¦ˆ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ì–´ê¹¨ë„ˆë¹„</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ê°€ìŠ´ë‘˜ë ˆ</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ì†Œë§¤ê¸¸ì´</th>
                            <th style="padding: 10px; border: 1px solid #ddd;">ì´ê¸¸ì´</th>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;">S</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">42cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">96cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">58cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">62cm</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;">M</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">44cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">100cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">60cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">64cm</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border: 1px solid #ddd;">L</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">46cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">104cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">62cm</td>
                            <td style="padding: 10px; border: 1px solid #ddd;">66cm</td>
                        </tr>
                    </table>
                </div>

                <div class="tab-content" id="reviews">
                    <h3>ê³ ê° ai ì°©ìƒ· ë¦¬ë·°</h3>

                    <!-- ê¸°ì¡´ ë¦¬ë·°ë“¤ -->
                    <% if (reviews && reviews.length > 0) { %>
                    <% reviews.forEach(review => { %>
                        <div class="review-item">
                        <div class="review-header">
                            <span class="reviewer-name"><%= review.username.slice(0, 1) %>**</span>
                            <span class="review-date"><%= new Date(review.created_at).toISOString().split('T')[0] %></span>
                        </div>
                        <div class="review-rating">
                            <% for (let i = 1; i <= 5; i++) { %>
                            <% if (i <= review.rating) { %>
                                <i class="fas fa-star"></i>
                            <% } else { %>
                                <i class="far fa-star"></i>
                            <% } %>
                            <% } %>
                        </div>
                        <% if (review.ai_image_url) { %>
                            <div style="margin: 10px 0;">
                                <img src="<%= review.ai_image_url %>" alt="AI ì°©ìƒ·" style="max-width: 250px; border: 1px solid #ccc; border-radius: 6px;">
                                <p style="font-size: 14px; color: gray; margin-top: 4px;">AI ê°€ìƒ í”¼íŒ…</p>
                            </div>
                        <% } %>

                        <% if (review.real_image_url) { %>
                            <div style="margin: 10px 0;">
                                <img src="<%= review.real_image_url %>" alt="ì‹¤ì œ ì°©ìš© ì‚¬ì§„" style="max-width: 250px; border: 1px solid #ccc; border-radius: 6px;">
                                <p style="font-size: 14px; color: gray; margin-top: 4px;">ì‹¤ì œ ì°©ìš© ì‚¬ì§„</p>
                            </div>
                        <% } %>

                        <p><%= review.content || '' %></p>

                        </div>
                    <% }); %>
                    <% } else { %>
                        <p style="color: gray;">ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    <% } %>


                    <!-- âœ ë¦¬ë·° ì‘ì„± í¼ -->
                    <!-- âœ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ AI ì°©ìƒ· ë³´ê¸° -->
                    <!-- âœ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ AI ì°©ìƒ· ë³´ê¸° -->
                    <!-- âœ ë¦¬ë·° ì‘ì„± í¼ -->
                    <% if (canReview) { %>
                    <div class="review-form-wrapper">
                        <h4 class="review-title">ğŸ§ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ AI ì°©ìƒ· ê³µìœ </h4>

                        <!-- âœ… ë‚´ AI ì°©ìƒ· ë¯¸ë¦¬ë³´ê¸° -->
                        <% if (myTryonImage) { %>
                            <div class="my-tryon-preview">
                                <p class="preview-label">ë‚´ AI ì°©ìƒ· ë¯¸ë¦¬ë³´ê¸° ğŸ‘•</p>
                                <div class="image-container">
                                    <img src="<%= myTryonImage %>" alt="ë‚´ AI ì°©ìƒ·" class="tryon-image">
                                    <div class="image-overlay">
                                        <span class="overlay-text">AI ì°©ìƒ·</span>
                                    </div>
                                </div>
                            </div>
                        <% } %>

                        <form action="/api/v1/review" method="POST" enctype="multipart/form-data" class="review-form">
                            <input type="hidden" name="cloth_id" value="<%= item.id %>">
                            <input type="hidden" name="user_id" value="<%= user ? user.id : '' %>">
                            <input type="hidden" name="ai_image_url" value="<%= myTryonImage %>">

                            <!-- ë³„ì  ì„ íƒ -->
                            <div class="form-group">
                                <label class="form-label">í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</label>
                                <div class="star-rating">
                                    <input type="radio" name="rating" value="5" id="star5">
                                    <label for="star5" class="star">â˜…</label>
                                    <input type="radio" name="rating" value="4" id="star4">
                                    <label for="star4" class="star">â˜…</label>
                                    <input type="radio" name="rating" value="3" id="star3">
                                    <label for="star3" class="star">â˜…</label>
                                    <input type="radio" name="rating" value="2" id="star2">
                                    <label for="star2" class="star">â˜…</label>
                                    <input type="radio" name="rating" value="1" id="star1">
                                    <label for="star1" class="star">â˜…</label>
                                </div>
                                <div class="rating-text">ë³„ì„ í´ë¦­í•´ì„œ í‰ì ì„ ë§¤ê²¨ì£¼ì„¸ìš”</div>
                            </div>

                            <!-- ë¦¬ë·° ë‚´ìš© -->
                            <div class="form-group">
                                <label for="content" class="form-label">í•œì¤„ ëŠë‚Œ ë˜ëŠ” AI ì°©ìƒ· ì„¤ëª… (ì„ íƒ)</label>
                                <div class="textarea-wrapper">
                                    <textarea name="content" id="content" rows="4" placeholder="ì˜ˆ: íŒ” ê¸¸ì´ê°€ ì¢€ ì§§ê²Œ ë‚˜ì™”ì–´ìš”! AI ì°©ìƒ·ì´ ì‹¤ì œì™€ ë¹„ìŠ·í•´ìš”!" class="styled-textarea"></textarea>
                                    <div class="textarea-border"></div>
                                </div>
                            </div>

                            <!-- ì‹¤ì œ ì°©ìƒ· ì²¨ë¶€ -->
                            <div class="form-group">
                                <label for="real_image" class="form-label">ì‹¤ì œ ì°©ìƒ· ì²¨ë¶€ (ì„ íƒ)</label>
                                <div class="file-upload-wrapper">
                                    <input type="file" name="real_image" id="real_image" accept="image/*" class="file-input">
                                    <label for="real_image" class="file-upload-label">
                                        <div class="upload-icon">ğŸ“·</div>
                                        <div class="upload-text">
                                            <span class="upload-main">ì‚¬ì§„ ì„ íƒí•˜ê¸°</span>
                                            <span class="upload-sub">ì‹¤ì œ ì°©ìš© ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</span>
                                        </div>
                                    </label>
                                    <div class="file-preview" id="filePreview"></div>
                                </div>
                            </div>

                            <button type="submit" class="submit-btn">
                                <span class="btn-icon">ğŸš€</span>
                                <span class="btn-text">AI ì°©ìƒ· ê³µìœ í•˜ê¸°</span>
                                <div class="btn-shine"></div>
                            </button>
                        </form>
                    </div>
                    <% } else { %>
                    <div class="review-form-wrapper disabled">
                        <div class="disabled-message">
                            <div class="disabled-icon">âš ï¸</div>
                            <p class="disabled-text">AI ì°©ìƒ· ê³µìœ ëŠ” í•´ë‹¹ ìƒí’ˆì„ êµ¬ë§¤í•œ ì‚¬ìš©ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                            <div class="disabled-decoration"></div>
                        </div>
                    </div>
                    <% } %>
                        


                </div>


                <div class="tab-content" id="shipping">
                    <h3>ë°°ì†¡ ë° êµí™˜/ë°˜í’ˆ ì•ˆë‚´</h3>
                    <h4>ë°°ì†¡ ì •ë³´</h4>
                    <ul>
                        <li>ë°°ì†¡ë¹„: ë¬´ë£Œ (5ë§Œì› ì´ìƒ êµ¬ë§¤ì‹œ)</li>
                        <li>ë°°ì†¡ê¸°ê°„: ì£¼ë¬¸ í›„ 1-3ì¼ (ì˜ì—…ì¼ ê¸°ì¤€)</li>
                        <li>ë°°ì†¡ì§€ì—­: ì „êµ­ (ì œì£¼ë„, ë„ì„œì‚°ê°„ ì§€ì—­ ì¶”ê°€ ë°°ì†¡ë¹„)</li>
                    </ul>
                    <br>
                    <h4>êµí™˜/ë°˜í’ˆ ì•ˆë‚´</h4>
                    <ul>
                        <li>êµí™˜/ë°˜í’ˆ ê¸°ê°„: ìƒí’ˆ ìˆ˜ë ¹ í›„ 7ì¼ ì´ë‚´</li>
                        <li>êµí™˜/ë°˜í’ˆ ë¹„ìš©: ê³ ê° ë³€ì‹¬ì‹œ ì™•ë³µ ë°°ì†¡ë¹„ ê³ ê° ë¶€ë‹´</li>
                        <li>êµí™˜/ë°˜í’ˆ ë¶ˆê°€: ì°©ìš© í”ì ì´ ìˆëŠ” ê²½ìš°, ì„¸íƒí•œ ê²½ìš°</li>
                    </ul>
                </div>

                <div class="tab-content" id="qna">
                    <h3>ìƒí’ˆ ë¬¸ì˜</h3>
                    <p>ìƒí’ˆì— ëŒ€í•œ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.</p>
                    <button class="btn btn-primary" style="margin-top: 1rem;">ë¬¸ì˜í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Try-On Modal -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-magic"></i> AI ê°€ìƒ í”¼íŒ…</h2>
                <button class="close-modal" onclick="closeAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
                    <p>ì „ì‹  ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ì´ ì˜·ì„ ì…í˜€ë“œë¦½ë‹ˆë‹¤</p>
                    <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="handleFileUpload(event)">
                </div>
                <div class="preview-container" id="previewContainer">
                    <img id="previewImage" class="preview-image" alt="ë¯¸ë¦¬ë³´ê¸°">
                    <button class="btn btn-primary" onclick="submitTryon()">
                        <i class="fas fa-magic"></i> AI ì²˜ë¦¬ ì‹œì‘
                    </button>
                </div>
                <div id="aiResult" style="display: none; text-align: center; margin-top: 2rem;">
                    <h3>AI ì²˜ë¦¬ ì™„ë£Œ!</h3>
                    <p>ê°€ìƒ í”¼íŒ… ê²°ê³¼ì…ë‹ˆë‹¤.</p>
                    <button class="btn btn-secondary" onclick="downloadResult()">
                        <i class="fas fa-download"></i> ê²°ê³¼ ì €ì¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Image gallery
        function changeMainImage(thumbnail) {
            const mainImage = document.getElementById('mainImage');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            mainImage.src = thumbnail.src;
            thumbnails.forEach(thumb => thumb.classList.remove('active'));
            thumbnail.classList.add('active');
        }

        // Color selection
        function selectColor(colorOption) {
            const colorOptions = document.querySelectorAll('.color-option');
            const selectedColorSpan = document.getElementById('selectedColor');
            
            colorOptions.forEach(option => option.classList.remove('active'));
            colorOption.classList.add('active');
            selectedColorSpan.textContent = colorOption.dataset.color;
        }

        // Size selection
        function selectSize(sizeOption) {
            if (sizeOption.classList.contains('disabled')) return;
            
            const sizeOptions = document.querySelectorAll('.size-option:not(.disabled)');
            const selectedSizeSpan = document.getElementById('selectedSize');
            
            sizeOptions.forEach(option => option.classList.remove('active'));
            sizeOption.classList.add('active');
            selectedSizeSpan.textContent = sizeOption.dataset.size;
        }

        // Quantity control
        function changeQuantity(change) {
            const quantityInput = document.getElementById('quantity');
            let currentValue = parseInt(quantityInput.value);
            let newValue = currentValue + change;
            
            if (newValue >= 1 && newValue <= 10) {
                quantityInput.value = newValue;
            }
        }

        // Wishlist toggle
        function toggleWishlist() {
            const wishlistIcon = document.getElementById('wishlistIcon');
            if (wishlistIcon.classList.contains('far')) {
                wishlistIcon.classList.remove('far');
                wishlistIcon.classList.add('fas');
                alert('ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                wishlistIcon.classList.remove('fas');
                wishlistIcon.classList.add('far');
                alert('ì°œ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }







        document.addEventListener('DOMContentLoaded', function() {
            // íŒŒì¼ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸°
            const fileInput = document.getElementById('real_image');
            const filePreview = document.getElementById('filePreview');
            
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            filePreview.innerHTML = `
                                <div style="margin-top: 1rem;">
                                    <p style="margin-bottom: 0.5rem; font-weight: 500; color: #333;">ë¯¸ë¦¬ë³´ê¸°:</p>
                                    <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 200px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                                </div>
                            `;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        filePreview.innerHTML = '';
                    }
                });
            }
            
            // ë³„ì  ì„ íƒ ì‹œ íš¨ê³¼ìŒ (ì„ íƒì‚¬í•­)
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    // ì„ íƒëœ ë³„ì  í‘œì‹œ
                    const ratingText = document.querySelector('.rating-text');
                    const selectedRating = this.previousElementSibling.value;
                    const ratingTexts = {
                        '1': 'ë³„ë¡œì˜ˆìš” ğŸ˜',
                        '2': 'ê·¸ì € ê·¸ë˜ìš” ğŸ˜',
                        '3': 'ë³´í†µì´ì—ìš” ğŸ™‚',
                        '4': 'ì¢‹ì•„ìš”! ğŸ˜Š',
                        '5': 'ìµœê³ ì˜ˆìš”! ğŸ¤©'
                    };
                    ratingText.textContent = ratingTexts[selectedRating] || 'ë³„ì„ í´ë¦­í•´ì„œ í‰ì ì„ ë§¤ê²¨ì£¼ì„¸ìš”';
                    ratingText.style.color = '#ff6b35';
                    ratingText.style.fontWeight = 'bold';
                });
            });
        });

        // detail.ejsì—ì„œ "ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°" ì‹œ, í•´ë‹¹ ì˜·ì˜ type(ë˜ëŠ” category, gender ë“±)ì„ localStorageì— ì €ì¥
        function addToCart() {
    const size = document.getElementById('selectedSize').textContent;
    const quantity = document.getElementById('quantity').value;
    const user_id = '<%= user ? user.id : "" %>';
    const cloth_id = '<%= item.id %>';
    const name = '<%= item.name %>';
    const image_url = "<%= item.image_url %>";
    const type = '<%= item.type %>'; // ì˜·ì˜ type (ì˜ˆ: 'ìƒì˜', 'í•˜ì˜', 'ì•„ìš°í„°' ë“±)

    const cartData = {
        user_id,
        cloth_id,
        name,
        image_url,
        size,
        quantity,
        type
    };

    // íƒ€ì… ì½˜ì†”ë¡œê·¸ë¡œ í™•ì¸
    console.log("ì„ íƒëœ íƒ€ì…:", type);  

    console.log("ë³´ë‚´ëŠ” ë°ì´í„°:", cartData);

    fetch('/api/v1/cartgo', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(cartData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showCartPopup();
        } else {
            let reason = data.message || data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì´ìœ ';
            alert('ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì‚¬ìœ : ' + reason);
        }
    })
    .catch((err) => {
        alert('ì¥ë°”êµ¬ë‹ˆ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n' + (err.message || err));
    });
}

        
        // Buy now
        function buyNow() {
            const selectedSize = document.getElementById('selectedSize').textContent;
            const selectedColor = document.getElementById('selectedColor').textContent;
            const quantity = document.getElementById('quantity').value;
            
            alert(`ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤!\nìƒ‰ìƒ: ${selectedColor}\nì‚¬ì´ì¦ˆ: ${selectedSize}\nìˆ˜ëŸ‰: ${quantity}`);
        }

        // Tab functionality
        function showTab(tabName) {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // AI Modal functions
        function openAIModal() {
            document.getElementById('aiModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAIModal() {
            document.getElementById('aiModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset modal state
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('aiResult').style.display = 'none';
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('uploadArea').style.display = 'none';
                    document.getElementById('previewContainer').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function processAI() {
            // Simulate AI processing
            alert('AI ì²˜ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...');
            
            setTimeout(() => {
                document.getElementById('previewContainer').style.display = 'none';
                document.getElementById('aiResult').style.display = 'block';
            }, 2000);
        }

        function downloadResult() {
            alert('AI ì²˜ë¦¬ ê²°ê³¼ê°€ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤!');
        }

        // Drag and drop for file upload
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('previewImage').src = e.target.result;
                        document.getElementById('uploadArea').style.display = 'none';
                        document.getElementById('previewContainer').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('aiModal');
            if (e.target === modal) {
                closeAIModal();
            }
        });


        function showCartPopup() {
            const popup = document.getElementById('cartPopup');
            popup.classList.add('show');

            // ëª‡ ì´ˆ í›„ ìë™ ì‚¬ë¼ì§ (ì„ íƒì‚¬í•­)
            setTimeout(() => {
            popup.classList.remove('show');
            }, 8000); // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
        }

        function goToCart() {
            window.location.href = '/cart';
        }  

        let selectedFile = null;

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            selectedFile = file;

            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('previewContainer').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

                
        
        
        function downloadResult() {
            const imageUrl = document.getElementById('downloadResult').dataset.url;
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = 'ai_result.jpg';
            link.click();
        }
        
          async function submitTryon() {
            const fileInput = document.getElementById('avatarInput');
            const file = document.getElementById('fileInput').files[0];
            if (!file) {
            alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
            return;
            }

            const formData = new FormData();
            formData.append('avatar', file);
            formData.append('cloth_id', document.getElementById('clothId').value);
            formData.append('type', document.getElementById('clothType').value);
            formData.append('image_url', document.getElementById('clothImageUrl').value);

            try {
            const res = await fetch('/api/v1/detail/ai-tryon', {
                method: 'POST',
                body: formData
            });

            const result = await res.json();
            if (result.success) {
                const img = document.getElementById('resultImage');
                img.src = result.imageUrl;
                document.getElementById('tryonResult').style.display = 'block';
            } else {
                alert('AI ì²˜ë¦¬ ì‹¤íŒ¨: ' + result.error);
            }
            } catch (err) {
            console.error(err);
            alert('ì„œë²„ ì˜¤ë¥˜');
            }
        }

        function downloadResult() {
            const url = document.getElementById('resultImage').src;
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai_result.jpg';
            a.click();
        }
        </script>






        <!-- âœ… ì—¬ê¸°ì— íŒì—… ì‚½ì… -->
<div id="cartPopup" class="cart-popup">
  <p>ğŸ›’ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤!</p>
  <button onclick="goToCart()">ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™</button>
</div>
</body>
</html>
</html>